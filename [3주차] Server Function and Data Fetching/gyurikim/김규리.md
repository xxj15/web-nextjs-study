# ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ë° ìºì‹±

## ê°€ì¥ ê¸°ë³¸ì ì¸ ë°ì´í„° fetching ì½”ë“œ

```tsx
export default async function Page() {
  const data = await fetch("https://api.vercel.app/blog");
  const posts = await data.json();
  return (
    <ul>
      {posts.map((post) => (
        <li key={post.id}>{post.title}</li>
      ))}
    </ul>
  );
}
```

ì´ ì˜ˆì œëŠ” ë¹„ë™ê¸° React ì„œë²„ ì»´í¬ë„ŒíŠ¸(React Server Component)ì—ì„œ fetch APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë²„ ì¸¡ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê¸°ë³¸ì ì¸ ë°©ë²•ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.

## ë°ì´í„° í˜ì¹­ ì˜ˆì œ

### â‘  ì„œë²„ì—ì„œ fetch APIë¡œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°

ì´ ì»´í¬ë„ŒíŠ¸ëŠ” ë¸”ë¡œê·¸ ê²Œì‹œê¸€ ëª©ë¡ì„ ê°€ì ¸ì™€ í™”ë©´ì— í‘œì‹œí•©ë‹ˆë‹¤.
**`fetch`ë¡œ ë°›ì•„ì˜¨ ì‘ë‹µì€ ê¸°ë³¸ì ìœ¼ë¡œ ìºì‹œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**

```tsx
// app/page.tsx

export default async function Page() {
  const data = await fetch("https://api.vercel.app/blog");
  const posts = await data.json();
  return (
    <ul>
      {posts.map((post) => (
        <li key={post.id}>{post.title}</li>
      ))}
    </ul>
  );
}
```

ğŸ‘‰ ì´ ë¼ìš°íŠ¸ ë‚´ì—ì„œ **ë‹¤ì´ë‚˜ë¯¹ API(ì¿ í‚¤, í—¤ë”, searchParams ë“±)** ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´, í•´ë‹¹ í˜ì´ì§€ëŠ” `next build` ì‹œ ì •**ì  í˜ì´ì§€ë¡œ ë¯¸ë¦¬ ë Œë”ë§(prerendering)** ë©ë‹ˆë‹¤.
ì´í›„ **Incremental Static Regeneration (ISR)** ì„ í†µí•´ **ë°ì´í„°ë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ ê°±ì‹ **í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë§Œì•½ ì •ì  ë Œë”ë§ì„ ê°•ì œë¡œ ë§‰ê³  ì‹¶ë‹¤ë©´, ì•„ë˜ ì½”ë“œë¥¼ ì¶”ê°€í•˜ì„¸ìš”:

```tsx
export const dynamic = "force-dynamic";
```

í•˜ì§€ë§Œ ë³´í†µì€ **ì¿ í‚¤, í—¤ë”, ê²€ìƒ‰ íŒŒë¼ë¯¸í„°** ë“±ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ê°€ ë§ì•„ ìë™ìœ¼ë¡œ ë‹¤ì´ë‚˜ë¯¹ ë Œë”ë§ì´ ì ìš©ë˜ë¯€ë¡œ, `force-dynamic`ì„ ëª…ì‹œì ìœ¼ë¡œ ì¶”ê°€í•  í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤.

### â‘¡ ORMì´ë‚˜ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ í†µí•´ ì„œë²„ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°

ì´ ì»´í¬ë„ŒíŠ¸ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê²Œì‹œê¸€ ëª©ë¡ì„ ê°€ì ¸ì™€ í™”ë©´ì— í‘œì‹œí•©ë‹ˆë‹¤.
ê¸°ë³¸ì ìœ¼ë¡œ **DB ì¿¼ë¦¬ ê²°ê³¼ëŠ” ìºì‹œë˜ì§€ ì•Šì§€ë§Œ**, ì¶”ê°€ ì„¤ì •ì„ í†µí•´ ìºì‹±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
// app/page.tsx

import { db, posts } from "@/lib/db";

export default async function Page() {
  const allPosts = await db.select().from(posts);
  return (
    <ul>
      {allPosts.map((post) => (
        <li key={post.id}>{post.title}</li>
      ))}
    </ul>
  );
}
```

ì—­ì‹œ, ë‹¤ë¥¸ ë‹¤ì´ë‚˜ë¯¹ APIë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ ë¹Œë“œ ì‹œ ì •ì  í˜ì´ì§€ë¡œ ë Œë”ë§ë˜ê³ , ISRë¡œ ê°±ì‹  ê°€ëŠ¥í•©ë‹ˆë‹¤.

ì •ì  ë Œë”ë§ì„ ë§‰ê³  ì‹¶ì„ ê²½ìš° ë˜‘ê°™ì´ `export const dynamic = 'force-dynamic'` ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

### â‘¢ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°

ê¸°ë³¸ì ìœ¼ë¡œëŠ” **ì„œë²„ ì¸¡ì—ì„œ ë¨¼ì € ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²ƒì„ ì¶”ì²œ**í•©ë‹ˆë‹¤.

í•˜ì§€ë§Œ ìƒí™©ì— ë”°ë¼ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì•¼ í•  ë•Œë„ ìˆìœ¼ë©°,
ì´ë•ŒëŠ” **`useEffect`ë¥¼ í†µí•´ `fetch`ë¥¼ ì§ì ‘ ì‚¬ìš©**í•  ìˆ˜ë„ ìˆê³ , ë³´í†µì€ **`SWR`, `React Query` ê°™ì€ ì¸ê¸° ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™œìš©**í•©ë‹ˆë‹¤.

```tsx
"use client";

import { useState, useEffect } from "react";

export function Posts() {
  const [posts, setPosts] = useState(null);

  useEffect(() => {
    async function fetchPosts() {
      const res = await fetch("https://api.vercel.app/blog");
      const data = await res.json();
      setPosts(data);
    }
    fetchPosts();
  }, []);

  if (!posts) return <div>Loading...</div>;

  return (
    <ul>
      {posts.map((post) => (
        <li key={post.id}>{post.title}</li>
      ))}
    </ul>
  );
}
```

## ìºì‹±

### â‘  ORMì´ë‚˜ DB ê²°ê³¼ë¥¼ ìºì‹±í•˜ê¸°

`unstable_cache` APIë¥¼ ì‚¬ìš©í•˜ë©´ ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ê²°ê³¼ë¥¼ `next build` ì¤‘ì— ìºì‹±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
import { unstable_cache } from "next/cache";
import { db, posts } from "@/lib/db";

const getPosts = unstable_cache(
  async () => {
    return await db.select().from(posts);
  },
  ["posts"],
  { revalidate: 3600, tags: ["posts"] }
);

export default async function Page() {
  const allPosts = await getPosts();

  return (
    <ul>
      {allPosts.map((post) => (
        <li key={post.id}>{post.title}</li>
      ))}
    </ul>
  );
}
```

ì´ ì½”ë“œëŠ” DB ì¿¼ë¦¬ ê²°ê³¼ë¥¼ 3600ì´ˆ(1ì‹œê°„) ë™ì•ˆ ìºì‹±í•˜ë©°,
`posts`ë¼ëŠ” íƒœê·¸ë¥¼ ë¶™ì—¬ì„œ ISRë¡œ ìºì‹œë¥¼ ë¬´íš¨í™”í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

### â‘¡ ì—¬ëŸ¬ í•¨ìˆ˜ì—ì„œ ë°ì´í„°ë¥¼ ì¬ì‚¬ìš©í•˜ê¸°

> â“ ê·¸ëŸ¼ ì‹¤ì œ ë™ì‘ì´ ì–´ë–»ë‹¤ëŠ” ê±°ì§€?

í˜ì´ì§€ì—ì„œ ê°€ì ¸ì˜¨ ê°™ì€ ë°ì´í„°ë¥¼ ì‚¬ìš©í•´ì•¼ í•  í•„ìš”ê°€ ìˆì„ ë•Œ, Next.jsì—ì„œ `generateMetadata`, `generateStaticParams`ì™€ ê°™ì€ APIë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
ë§Œì•½ fetchë¥¼ ì‚¬ìš©í•œë‹¤ë©´, `cache: 'force-cache'` ì˜µì…˜ì„ ì¶”ê°€í•˜ì—¬ ìš”ì²­ì´ ë©”ëª¨ì´ì œì´ì…˜(memoization)ë˜ì–´, ê°™ì€ URLê³¼ ì˜µì…˜ìœ¼ë¡œ ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œí•´ë„ ì‹¤ì œë¡œëŠ” í•œ ë²ˆë§Œ ìš”ì²­ì´ ë°œìƒí•©ë‹ˆë‹¤.

> ğŸ’¡ **ì°¸ê³ **  
> ì´ì „ ë²„ì „ì˜ Next.jsì—ì„œëŠ” fetchì˜ ê¸°ë³¸ ìºì‹œ ì˜µì…˜ì´ `'force-cache'`ì˜€ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ Next.js 15ë¶€í„°ëŠ” ê¸°ë³¸ê°’ì´ `no-store`ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.

```tsx
import { notFound } from "next/navigation";

interface Post {
  id: string;
  title: string;
  content: string;
}

// íŠ¹ì • ê²Œì‹œê¸€ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
async function getPost(id: string) {
  const res = await fetch(`https://api.vercel.app/blog/${id}`, {
    cache: "force-cache",
  });
  const post: Post = await res.json();
  if (!post) notFound();
  return post;
}

// ì •ì  ê²½ë¡œ ìƒì„±ì„ ìœ„í•œ í•¨ìˆ˜
export async function generateStaticParams() {
  const posts = await fetch("https://api.vercel.app/blog", {
    cache: "force-cache",
  }).then((res) => res.json());

  return posts.map((post: Post) => ({
    id: String(post.id),
  }));
}

// ë©”íƒ€ë°ì´í„°ë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ëŠ” í•¨ìˆ˜
export async function generateMetadata({
  params,
}: {
  params: Promise<{ id: string }>;
}) {
  const { id } = await params;
  const post = await getPost(id);

  return {
    title: post.title,
  };
}

// í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸
export default async function Page({
  params,
}: {
  params: Promise<{ id: string }>;
}) {
  const { id } = await params;
  const post = await getPost(id);

  return (
    <article>
      <h1>{post.title}</h1>
      <p>{post.content}</p>
    </article>
  );
}
s;
```

#### ORMì´ë‚˜ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ëŠ” ê²½ìš°

> â“ unstable_cacheë‘ ë­ê°€ ë‹¤ë¥¸ê±°ì§€?

`fetch` ëŒ€ì‹  ORM ë˜ëŠ” DB ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, Reactì˜ `cache()` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ìºì‹±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ í•¨ìˆ˜ëŠ” **ì¤‘ë³µ í˜¸ì¶œì„ ë°©ì§€**í•˜ê³ , **í•˜ë‚˜ì˜ ì¿¼ë¦¬ë§Œ ì‹¤í–‰**ë˜ë„ë¡ í•´ì¤ë‹ˆë‹¤.

```tsx
import { cache } from "react";
import { db, posts, eq } from "@/lib/db";
import { notFound } from "next/navigation";

// React cache í•¨ìˆ˜ë¡œ ê°ì‹¼ getPost
export const getPost = cache(async (id) => {
  const post = await db.query.posts.findFirst({
    where: eq(posts.id, parseInt(id)),
  });

  if (!post) notFound();
  return post;
});
```

## ìºì‹œëœ ë°ì´í„° ë‹¤ì‹œ ê²€ì¦í•˜ê¸° (Revalidation)

Incremental Static Regeneration(ISR) ê¸°ëŠ¥ì„ í™œìš©í•˜ì—¬, ìºì‹œëœ ë°ì´í„°ë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ ë‹¤ì‹œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¡œì¨ ì •ì  í˜ì´ì§€ë„ ë°ì´í„°ê°€ ë³€ê²½ë˜ë©´ ìƒˆë¡­ê²Œ ë°˜ì˜í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.

## íŒ¨í„´

ì»´í¬ë„ŒíŠ¸ ì•ˆì—ì„œ ë°ì´í„°ë¥¼ í˜ì¹­í•  ë•Œ, ë‘ ê°€ì§€ ë°ì´í„° í˜ì¹­ íŒ¨í„´ì´ ìˆìŠµë‹ˆë‹¤.

- **ìˆœì°¨ì  ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (Sequential)**  
  ìˆœì°¨(Sequential)ì ì¸ ìš”ì²­ì€ **ì»´í¬ë„ŒíŠ¸ íŠ¸ë¦¬ì—ì„œ ìš”ì²­ë“¤ì´ ì„œë¡œ ì˜ì¡´ì ì¼ ë•Œ ë°œìƒ**í•©ë‹ˆë‹¤. ì´ ê²½ìš° í•œ ìš”ì²­ì´ ëë‚˜ì•¼ ë‹¤ìŒ ìš”ì²­ì´ ì‹œì‘ë˜ë¯€ë¡œ, **ì „ì²´ ë¡œë”© ì‹œê°„ì´ ê¸¸ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.**
- **ë³‘ë ¬ì  ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (Parallel)**  
  ë™ì‹œì—, route(ê²½ë¡œ) ì•ˆì˜ ìš”ì²­ë“¤ì´ ë³´ë‚´ì§€ê³ , ë°ì´í„°ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤. ì´ëŸ° ë°©ë²•ì€ ë°ì´í„°ê°€ ë¡œë“œë˜ëŠ” ì´ ì‹œê°„ì„ ë‹¨ì¶•ì‹œí‚µë‹ˆë‹¤.

### ìˆœì°¨(Sequential) ë° ë³‘ë ¬(Parallel) ë°ì´í„° ê°€ì ¸ì˜¤ê¸°

#### â‘  ìˆœì°¨(Sequential)ì  ë°ì´í„° ê°€ì ¸ì˜¤ê¸°(fetching)

ë§Œì•½ ì¤‘ì²©ëœ ì»´í¬ë„ŒíŠ¸ë¥¼ ê°€ì§€ê³  ìˆë‹¤ë©´, ê°ê°ì˜ ì»´í¬ë„ŒíŠ¸ëŠ” ê°ê° í•„ìš”í•œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê³ (fetching), ì´ëŸ¬í•œ **ë°ì´í„° fetchingì€** ë°ì´í„° ìš”ì²­ì´ ë©”ëª¨ì œì´ì…˜ë˜ì§€ ì•Šì•˜ë‹¤ë©´ **ìˆœì°¨ì ìœ¼ë¡œ ë°œìƒí•©ë‹ˆë‹¤.**

ì˜ˆë¥¼ ë“¤ì–´, `Playlists` ì»´í¬ë„ŒíŠ¸ê°€ `artistID`ë¥¼ í•„ìš”ë¡œ í•˜ëŠ” ê²½ìš°,
`getArtist()` ìš”ì²­ì´ ì™„ë£Œëœ í›„ì—ì•¼ `Playlists`ê°€ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê¸° ì‹œì‘í•©ë‹ˆë‹¤.

```tsx
// app/artist/[username]/page.tsx
export default async function Page({
  params,
}: {
  params: Promise<{ username: string }>;
}) {
  const { username } = await params;

  // ì•„í‹°ìŠ¤íŠ¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
  const artist = await getArtist(username);

  return (
    <>
      <h1>{artist.name}</h1>
      {/* Playlists ë¡œë”© ì¤‘ì¼ ë•Œ fallback UI ë³´ì—¬ì£¼ê¸° */}
      <Suspense fallback={<div>Loading...</div>}>
        <Playlists artistID={artist.id} />
      </Suspense>
    </>
  );
}

async function Playlists({ artistID }: { artistID: string }) {
  const playlists = await getArtistPlaylists(artistID);

  return (
    <ul>
      {playlists.map((playlist) => (
        <li key={playlist.id}>{playlist.name}</li>
      ))}
    </ul>
  );
}
```

ğŸ‘‰ ì´ êµ¬ì¡°ëŠ” `getArtist()` â†’ `getArtistPlaylists()` ìˆœìœ¼ë¡œ **ì˜ì¡´ì ì¸ ë¡œì§ì´ê¸° ë•Œë¬¸ì— ìˆœì°¨ì ìœ¼ë¡œ ë°ì´í„°ê°€ ë¡œë“œ**ë©ë‹ˆë‹¤.

> ğŸ’¡ **íŒ: `loading.js` ë˜ëŠ” `<Suspense>`ë¥¼ ì‚¬ìš© í•˜ê¸°**
>
> - `loading.js`: route segments ì „ìš©
> - `<Suspense>`: nested components ì „ìš©
>
> ë°ì´í„°ê°€ ì™„ì „íˆ ì¤€ë¹„ë˜ì§€ ì•Šì•„ë„ ì‚¬ìš©ìì—ê²Œ ì¼ë¶€ UIë¥¼ ë¨¼ì € ë³´ì—¬ì¤„ ìˆ˜ ìˆì–´
> **ì „ì²´ ê²½ë¡œê°€ ë°ì´í„° ìš”ì²­ ë•Œë¬¸ì— ì°¨ë‹¨ë˜ì§€ ì•Šë„ë¡ ë°©ì§€**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### â‘¡ ë³‘ë ¬(Parallel)ì  ë°ì´í„° ê°€ì ¸ì˜¤ê¸°(fetching)

ê¸°ë³¸ì ìœ¼ë¡œ `layout`ê³¼ `page` ì„¸ê·¸ë¨¼íŠ¸ëŠ” ë³‘ë ¬ë¡œ ë Œë”ë§ë©ë‹ˆë‹¤. ì¦‰, **ìš”ì²­ì´ ë³‘ë ¬ì ìœ¼ë¡œ ë³´ë‚´ì§„ë‹¤**ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

í•˜ì§€ë§Œ `async/await`ì˜ íŠ¹ì„± ë•Œë¬¸ì—, ì‚¬ìš©í•  ê²½ìš°, ê°™ì€ ì„¸ê·¸ë¨¼íŠ¸ë‚˜ ì»´í¬ë„ŒíŠ¸ ì•ˆì—ì„œ await ëœ ìš”ì²­ì´ ê·¸ ì•„ë˜ì— ìˆëŠ” ë‹¤ë¥¸ ìš”ì²­ì„ ë§‰ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> ğŸ‘‰ **ë³‘ë ¬ë¡œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ë ¤ë©´,**  
> ìš”ì²­ì„ ì»´í¬ë„ŒíŠ¸ ì™¸ë¶€ì—ì„œ ë¨¼ì € ì •ì˜í•˜ê³ ,
> ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œ `Promise.all()`ì„ ì´ìš©í•´ ë™ì‹œì— ì‹œì‘í•©ë‹ˆë‹¤.

```tsx
// app/artist/[username]/page.tsx

import Albums from "./albums";

async function getArtist(username: string) {
  const res = await fetch(`https://api.example.com/artist/${username}`);
  return res.json();
}

async function getAlbums(username: string) {
  const res = await fetch(`https://api.example.com/artist/${username}/albums`);
  return res.json();
}

export default async function Page({
  params,
}: {
  params: Promise<{ username: string }>;
}) {
  const { username } = await params;

  // ë³‘ë ¬ë¡œ ìš”ì²­ ì‹œì‘
  const artistData = getArtist(username);
  const albumsData = getAlbums(username);

  // ë™ì‹œì— ë‘ ìš”ì²­ì´ ëë‚˜ê¸°ë¥¼ ê¸°ë‹¤ë¦¼
  const [artist, albums] = await Promise.all([artistData, albumsData]);

  return (
    <>
      <h1>{artist.name}</h1>
      <Albums list={albums} />
    </>
  );
}
```

ğŸ‘‰ ì¶”ê°€ë¡œ, `<Suspense>` ê²½ê³„(Suspense Boundary)ë¥¼ ì¶”ê°€í•˜ë©´
ë Œë”ë§ ì‘ì—…ì„ ë‚˜ëˆ„ê³  ì¼ë¶€ ê²°ê³¼ë¥¼ ë¨¼ì € ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì£¼ëŠ” UXë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> â“ suspenseì— ëŒ€í•´ ì¢€ ë” ì•Œì•„ë³´ê¸°

### Preloading Data (ë°ì´í„° ë¯¸ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸°)

> â“ Preload ì˜ ëª¨ë¥´ê² ë‹¤..

> ì›Œí„°í´(ìˆœì°¨ì  ì§€ì—°)ì„ ë°©ì§€í•˜ëŠ” ë˜ ë‹¤ë¥¸ ë°©ë²•ì€ `preload` íŒ¨í„´ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
> ì´ëŠ” ì…ë‹ˆë‹¤.
> **ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ë³´ë‹¤ ë¨¼ì € ë°ì´í„° ë¡œë”©ì„ ì‹œì‘í•˜ëŠ” ì „ëµ**

```tsx
// components/Item.tsx

import { getItem } from "@/utils/get-item";

export const preload = (id: string) => {
  // void ì—°ì‚°ìëŠ” ì£¼ì–´ì§„ í‘œí˜„ì‹ì„ í‰ê°€í•˜ê³  undefinedë¥¼ ë°˜í™˜í•œë‹¤.
  // https://developer.mozilla.org/docs/Web/JavaScript/Reference/Operators/void
  void getItem(id);
};
export default async function Item({ id }: { id: string }) {
  const result = await getItem(id);
  // ...
}
```

```tsx
// app/item/[id]/page.tsx

import Item, { preload, checkIsAvailable } from "@/components/Item";

export default async function Page({
  params,
}: {
  params: Promise<{ id: string }>;
}) {
  const { id } = await params;

  // ë¨¼ì € item ë°ì´í„°ë¥¼ ë¡œë”© ì‹œì‘
  preload(id);

  // ë‹¤ë¥¸ ë¹„ë™ê¸° ì‘ì—… ìˆ˜í–‰
  const isAvailable = await checkIsAvailable();

  return isAvailable ? <Item id={id} /> : null;
}
```

#### React cache, server-only, preload íŒ¨í„´ í•¨ê»˜ ì‚¬ìš©í•˜ê¸°

`cache()` + `preload()` + `server-only` íŒ¨í‚¤ì§€ë¥¼ ê²°í•©í•˜ë©´
ì•± ì „ì²´ì—ì„œ ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì„œë²„ ì „ìš© ë°ì´í„° ìœ í‹¸ë¦¬í‹°ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
// utils/get-item.ts

import { cache } from "react";
import "server-only";

// preload í•¨ìˆ˜ë¡œ ë¯¸ë¦¬ ë°ì´í„° ë¡œë”©
export const preload = (id: string) => {
  void getItem(id);
};

// React cacheë¡œ ì¤‘ë³µ í˜¸ì¶œ ë°©ì§€ ë° ì„œë²„ ì „ìš© ì„¤ì •
export const getItem = cache(async (id: string) => {
  // ë°ì´í„° ë¡œì§...
});
```

ğŸ‘‰ ì´ ë°©ì‹ì€, ë°ì´í„°ë¥¼ ë¯¸ë¦¬ ê°€ì ¸ì˜¤ê³  ì¤‘ë³µ í˜¸ì¶œì„ ë°©ì§€í•˜ë©° **ì˜¤ì§ ì„œë²„ì—ì„œë§Œ ì‹¤í–‰ë˜ë„ë¡ ë³´ì¥**í•©ë‹ˆë‹¤.

### ë¯¼ê°í•œ ë°ì´í„° í´ë¼ì´ì–¸íŠ¸ ì „ë‹¬ ë°©ì§€ (Taint API)

ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ë¡œ ë¯¼ê°í•œ ë°ì´í„°ê°€ ì‹¤ìˆ˜ë¡œ ì „ë‹¬ë˜ëŠ” ê±¸ ë°©ì§€í•˜ê¸° ìœ„í•´
`React`ì˜ `Taint API`ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ğŸ“ ì„¤ì •: next.config.js**

```js
module.exports = {
  experimental: {
    taint: true,
  },
};
```

#### ì˜ˆì‹œ ì½”ë“œ

```tsx
// app/utils.ts

import { queryDataFromDB } from "./api";
import {
  experimental_taintObjectReference,
  experimental_taintUniqueValue,
} from "react";

export async function getUserData() {
  const data = await queryDataFromDB();

  // ì „ì²´ user ê°ì²´ë¥¼ í´ë¼ì´ì–¸íŠ¸ì— ë„˜ê¸°ì§€ ì•Šë„ë¡ ê²½ê³ 
  experimental_taintObjectReference(
    "Do not pass the whole user object to the client",
    data
  );

  // íŠ¹ì • ê°’(user.address)ì„ ë„˜ê¸°ì§€ ì•Šë„ë¡ ê²½ê³ 
  experimental_taintUniqueValue(
    "Do not pass the user's address to the client",
    data,
    data.address
  );

  return data;
}
```

```tsx
// app/page.tsx

import { getUserData } from "./data";

export async function Page() {
  const userData = getUserData();

  return (
    <ClientComponent
      user={userData} // âŒ taintObjectReferenceì— ì˜í•´ ì—ëŸ¬ ë°œìƒ
      address={userData.address} // âŒ taintUniqueValueì— ì˜í•´ ì—ëŸ¬ ë°œìƒ
    />
  );
}
```

# Server Actionsì™€ Mutations (ì„œë²„ ì•¡ì…˜ê³¼ ë°ì´í„° ë³€ê²½)

Server ActionsëŠ” ì„œë²„ì—ì„œ ì‹¤í–‰ë˜ëŠ” ë¹„ë™ê¸° í•¨ìˆ˜ì…ë‹ˆë‹¤.
Next.js ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ í¼ ì œì¶œ ì²˜ë¦¬ë‚˜ ë°ì´í„° ë³€ê²½(mutation) ì„ ìœ„í•´
Server ë° Client ì»´í¬ë„ŒíŠ¸ì—ì„œ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ì‘ì„± ê·œì¹™ (Convention)

Server Actionì€ Reactì˜ "use server" ì§€ì‹œì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì •ì˜í•©ë‹ˆë‹¤.

- íŠ¹ì • **ë¹„ë™ê¸° í•¨ìˆ˜** ìœ„ì— ì„ ì–¸í•˜ë©´ í•´ë‹¹ í•¨ìˆ˜ê°€ Server Actionì´ ë©ë‹ˆë‹¤.
- íŒŒì¼ ë§¨ ìœ„ì— ì„ ì–¸í•˜ë©´ ê·¸ íŒŒì¼ ë‚´ ëª¨ë“  export í•¨ìˆ˜ê°€ Server Actionìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.

### Server ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•˜ê¸°

Server ì»´í¬ë„ŒíŠ¸ì—ì„œëŠ” í•¨ìˆ˜ ë‚´ë¶€(inline) ë˜ëŠ” ëª¨ë“ˆ ì „ì²´ ìˆ˜ì¤€(module level) ì— `"use server"`ë¥¼ ì„ ì–¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
// app/page.tsx

export default function Page() {
  // ì„œë²„ ì•¡ì…˜ í•¨ìˆ˜
  async function create() {
    "use server";
    // ë°ì´í„°ë¥¼ ë³€ê²½í•˜ëŠ” ë¡œì§
  }

  return "...";
}
```

### Client ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•˜ê¸°

#### â‘  Client ì»´í¬ë„ŒíŠ¸ì—ì„œ Server Actionì„ importí•´ ì‚¬ìš©í•˜ê¸°

> âš ï¸ Client ì»´í¬ë„ŒíŠ¸ ì•ˆì—ì„œ ì§ì ‘ ì„ ì–¸í•  ìˆ˜ ì—†ë‹¤.

1. ë³„ë„ì˜ íŒŒì¼ì„ ë§Œë“¤ê³ 
2. ê·¸ íŒŒì¼ ë§¨ ìœ„ì— `"use server"`ë¥¼ ì„ ì–¸
3. ë‚´ë³´ë‚¸ í•¨ìˆ˜ë“¤ì„ `import`í•´ì„œ ì‚¬ìš©

```tsx
// app/actions.ts

"use server";

export async function create() {
  // ì„œë²„ì—ì„œ ì‹¤í–‰ë  ì½”ë“œ
}
```

```tsx
// app/button.tsx

"use client";

import { create } from "./actions";

export function Button() {
  return <button onClick={() => create()}>Create</button>;
}
```

#### â‘¡ Server Actionì„ propsë¡œ ì „ë‹¬í•˜ê¸°

Server Actionì€ props í˜•íƒœë¡œ Client ì»´í¬ë„ŒíŠ¸ì— ì „ë‹¬í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

```tsx
<ClientComponent updateItemAction={updateItem} />
```

```tsx
// app/client-component.tsx

"use client";

export default function ClientComponent({
  updateItemAction,
}: {
  updateItemAction: (formData: FormData) => void;
}) {
  return <form action={updateItemAction}>{/* í¼ ë‚´ë¶€ */}</form>;
}
```

> **âš ï¸ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ í”ŒëŸ¬ê·¸ì¸ ê´€ë ¨ ì£¼ì˜ì‚¬í•­**

- ì¼ë°˜ì ìœ¼ë¡œëŠ” `updateItemAction` ê°™ì€ í•¨ìˆ˜ë¥¼ `props`ë¡œ ì „ë‹¬í•˜ë©´
  **`TypeScript`ì—ì„œ ì§ë ¬í™”ê°€ ë¶ˆê°€ëŠ¥í•˜ë‹¤ë©° ì˜¤ë¥˜ë¥¼ ë°œìƒ**ì‹œí‚µë‹ˆë‹¤.

- ê·¸ëŸ¬ë‚˜ ì´ë¦„ì´ `action`ì´ê±°ë‚˜ `Action`ìœ¼ë¡œ ëë‚˜ëŠ” `props`ëŠ”
  **Server Actionì´ ì „ë‹¬ëœ ê²ƒìœ¼ë¡œ ê°„ì£¼í•˜ì—¬ ì˜¤ë¥˜ë¥¼ í”¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**
  (ì´ëŠ” `TypeScript`ì˜ **íœ´ë¦¬ìŠ¤í‹±(ì¶”ì • ê·œì¹™)** ì¼ ë¿ì´ë©° ì™„ë²½í•œ ê²€ì‚¬ ê¸°ëŠ¥ì€ ì•„ë‹™ë‹ˆë‹¤.)
- ì‹¤ì œë¡œëŠ” **ëŸ°íƒ€ì„ì—ì„œ íƒ€ì… ê²€ì¦ì´ ìˆ˜í–‰**ë˜ì–´, ì˜ëª»ëœ í•¨ìˆ˜ ì „ë‹¬ì€ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ë¡œ í™•ì¸ë©ë‹ˆë‹¤.

## Server Actionsì˜ ë™ì‘ ë°©ì‹ (Behavior)

1. `<form>` ìš”ì†Œì˜ `action` ì†ì„±ìœ¼ë¡œ Server Action í˜¸ì¶œ ê°€ëŠ¥

   - ì„œë²„ ì»´í¬ë„ŒíŠ¸ì—ì„œëŠ”, ì‚¬ìš©ìì˜ ë¸Œë¼ìš°ì €ì— ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ê±°ë‚˜ êº¼ì ¸ ìˆì–´ë„,
     í¼ì´ ì •ìƒì ìœ¼ë¡œ ì œì¶œë©ë‹ˆë‹¤. (ì ì§„ì  í–¥ìƒ(Progressive Enhancement))
   - í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ì—ì„œëŠ” ì´ˆê¸°ì—ëŠ” **ì œì¶œ ìš”ì²­ì´ íì‰(Queueing) ë¨**
     - ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€ ë¡œë“œë˜ê¸° ì „ì—ëŠ”, í¼ ì œì¶œ ìš”ì²­ì´ **í´ë¼ì´ì–¸íŠ¸ ìˆ˜í™”(hydration)ê°€ ì™„ë£Œë  ë•Œê¹Œì§€ ë³´ë¥˜**ë¨
     - ìˆ˜í™”ê°€ ëë‚œ í›„ì—ëŠ” **í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì—†ì´ ì œì¶œì´ ì²˜ë¦¬**ë©ë‹ˆë‹¤.

2. Server Actionì€ `<form>` ì™¸ì—ë„ ë‹¤ì–‘í•œ ë°©ì‹ìœ¼ë¡œ í˜¸ì¶œ ê°€ëŠ¥

   > - onClick, onSubmit ë“±ì˜ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
   > - useEffect ì•ˆì˜ í˜¸ì¶œ
   > - ì„œë“œíŒŒí‹° ë¼ì´ë¸ŒëŸ¬ë¦¬
   > - `<button>` ë‹¨ë… ì‚¬ìš© ë“± ë‹¤ì–‘í•œ ê²½ìš°

3. Server Actionì€ Next.jsì˜ ìºì‹± ë° revalidation ì•„í‚¤í…ì²˜ì™€ í†µí•© ë¨
   - ì•¡ì…˜ì´ ì‹¤í–‰ë˜ë©´, ë³€ê²½ëœ UIì™€ ìµœì‹  ë°ì´í„°ë¥¼ ì„œë²„ì—ì„œ í•œ ë²ˆì˜ ë¼ìš´ë“œíŠ¸ë¦½ìœ¼ë¡œ í•¨ê»˜ ë°˜í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
4. Server Actionì€ POST ë©”ì„œë“œë¡œ ì‘ë™í•˜ê³ , ì´ ë©”ì†Œë“œë§Œ ì‘ë™ì‹œí‚¬ ìˆ˜ ìˆìŒ
   - ì¦‰, GET, PUT ë“± ë‹¤ë¥¸ ë©”ì„œë“œë¡œëŠ” ì‹¤í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤
5. Server Actionì˜ ì¸ìì™€ ë°˜í™˜ ê°’ì€ Reactì—ì„œ ì§ë ¬í™”(serialize) ê°€ëŠ¥í•´ì•¼ í•¨
6. Server ActionsëŠ” í•¨ìˆ˜ì´ë¯€ë¡œ ì•± ì–´ë””ì—ì„œë‚˜ ì¬ì‚¬ìš© ê°€ëŠ¥
7. ì‚¬ìš©ëœ í˜ì´ì§€ë‚˜ ë ˆì´ì•„ì›ƒì˜ ëŸ°íƒ€ì„(runtime) ì„ ìë™ìœ¼ë¡œ ìƒì†
   - edge, nodejs ëŸ°íƒ€ì„ ë“± ì„¤ì •ì„ ë”°ë¦„
8. í•´ë‹¹ í˜ì´ì§€/ë ˆì´ì•„ì›ƒì˜ Route Segment Configë„ ìƒì†ë¨
   - ì˜ˆë¥¼ ë“¤ì–´ `maxDuration`, `dynamic`, `revalidate` ë“±ì˜ ì„¤ì •ë„ ì ìš©ë¨

## Server Actionì„ ì‚¬ìš©í•˜ëŠ” ì˜ˆì‹œ ìƒí™©

### í¼(Form)ì—ì„œ Server Action ì‚¬ìš©í•˜ê¸°

ReactëŠ” ê¸°ì¡´ HTMLì˜ `<form>` ìš”ì†Œë¥¼ í™•ì¥í•˜ì—¬, Server Actionì„ action ì†ì„±ìœ¼ë¡œ ì§ì ‘ í˜¸ì¶œí•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.

#### âœ… ê¸°ë³¸ ë™ì‘

- `<form>`ì—ì„œ Server Actionì„ í˜¸ì¶œí•˜ë©´, í•´ë‹¹ í•¨ìˆ˜ëŠ” ìë™ìœ¼ë¡œ FormData ê°ì²´ë¥¼ ì¸ìë¡œ ë°›ìŠµë‹ˆë‹¤.

- í•„ë“œ ê°’ì„ ìœ„í•´ `useState`ë¥¼ ì“¸ í•„ìš” ì—†ì´, `FormData.get()` ê°™ì€ ê¸°ë³¸ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ ë°ì´í„°ë¥¼ ì¶”ì¶œí•˜ë©´ ë©ë‹ˆë‹¤.

#### ì˜ˆì‹œ ì½”ë“œ

```tsx
export default function Page() {
  async function createInvoice(formData: FormData) {
    "use server";

    const rawFormData = {
      customerId: formData.get("customerId"),
      amount: formData.get("amount"),
      status: formData.get("status"),
    };

    // ë°ì´í„° ë³€ê²½
    // ìºì‹œ ë¦¬ë°¸ë¦¬ë°ì´íŠ¸
  }

  return <form action={createInvoice}>...</form>;
}
```

> **ğŸ’¡ íŒ: `FormData.entries()` + `Object.fromEntries()` í™œìš©**  
> í•„ë“œê°€ ë§ì€ ê²½ìš°ì—” ì•„ë˜ì²˜ëŸ¼ ì‘ì„±í•˜ë©´ ë” ê°„ê²°í•©ë‹ˆë‹¤:
>
> ```ts
> const rawFormData = Object.fromEntries(formData);
> ```
>
> ì£¼ì˜: formDataì—ëŠ” `$ACTION_` ë“±ì˜ ë‚´ë¶€ ì†ì„±ë„ í¬í•¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### âœš `FormData.entries()`, `Object.fromEntries()` ì— ëŒ€í•˜ì—¬

> `Object.entries(obj)` ê°ì²´ ==> ë°°ì—´  
> `Object.fromEntries(arr)` ë°°ì—´ ==> ê°ì²´

- [Object.entries() VS Object.fromEntries()](https://velog.io/@loocia1910/Object.entries-VS-Object.fromEntries)
- [Object.fromEntries()](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Object/fromEntries)

#### ì¶”ê°€ ì¸ì ì „ë‹¬í•˜ê¸°

Server Actionì— FormData ì™¸ì—ë„ ì¶”ê°€ ì¸ìë¥¼ ì „ë‹¬í•˜ê³  ì‹¶ì„ ë•ŒëŠ”
JavaScriptì˜ `bind` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
"use client";

import { updateUser } from "./actions";

export function UserProfile({ userId }: { userId: string }) {
  const updateUserWithId = updateUser.bind(null, userId);

  return (
    <form action={updateUserWithId}>
      <input type="text" name="name" />
      <button type="submit">Update User Name</button>
    </form>
  );
}
```

> ğŸ’¡ ëŒ€ì•ˆ ë°©ë²•  
> `<input type="hidden" name="userId" value={userId} />`  
> ìœ„ì™€ ê°™ì€ ë°©ì‹ë„ ê°€ëŠ¥í•˜ì§€ë§Œ, HTMLì— ë…¸ì¶œë˜ë©° ë³´ì•ˆ ì¸¡ë©´ì—ì„œ ì·¨ì•½í•  ìˆ˜ ìˆìŒ
> bind() ë°©ì‹ì€ ë³´ì•ˆì„±ê³¼ ì„œë²„ ì „ìš© ë¡œì§ì„ ìœ ì§€í•  ìˆ˜ ìˆìŒ

### ì¤‘ì²©ëœ Form ìš”ì†Œì—ì„œ Server Action í˜¸ì¶œí•˜ê¸°

`<form>` ë‚´ë¶€ì˜ `<button>`, `<input type="submit">`, `<input type="image">` ë“±
ëª¨ë“  ì œì¶œí˜• ìš”ì†Œì—ì„œ Server Actionì„ í˜¸ì¶œ ê°€ëŠ¥í•©ë‹ˆë‹¤.
`formAction` ì†ì„± ë˜ëŠ” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¡œ ì—°ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ğŸ“Œ ì˜ˆ: í•˜ë‚˜ì˜ í¼ ì•ˆì—ì„œ "ì„ì‹œ ì €ì¥" ë²„íŠ¼ê³¼ "ê²Œì‹œí•˜ê¸°" ë²„íŠ¼ì„ ê°ê° ë‹¤ë¥¸ Server Actionì— ì—°ê²° ê°€ëŠ¥

### í”„ë¡œê·¸ë˜ë° ë°©ì‹ìœ¼ë¡œ Form ì œì¶œí•˜ê¸°

ì‚¬ìš©ìê°€ ë‹¨ì¶•í‚¤(ì˜ˆ: âŒ˜ + Enter ë˜ëŠ” Ctrl + Enter)ë¥¼ ëˆ„ë¥´ë©´
`requestSubmit()` ë©”ì„œë“œë¥¼ ì´ìš©í•´ í¼ì„ í”„ë¡œê·¸ë˜ë° ë°©ì‹ìœ¼ë¡œ ì œì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
"use client";

export function Entry() {
  const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {
    if (
      (e.ctrlKey || e.metaKey) &&
      (e.key === "Enter" || e.key === "NumpadEnter")
    ) {
      e.preventDefault();
      e.currentTarget.form?.requestSubmit();
    }
  };

  return (
    <div>
      <textarea name="entry" rows={20} required onKeyDown={handleKeyDown} />
    </div>
  );
}
```

ì´ ë°©ì‹ì€ ê°€ì¥ ê°€ê¹Œìš´ `<form>` ìš”ì†Œë¥¼ ì°¾ì•„ Server Actionì„ ì‹¤í–‰ì‹œí‚µë‹ˆë‹¤.

### ì„œë²„ ì¸¡ í¼ ê²€ì¦ (Server-side Form Validation)

`required`, `type="email"` ê°™ì€ HTML ì†ì„±ì„ ì‚¬ìš©í•˜ë©´ ê¸°ë³¸ì ì¸ í´ë¼ì´ì–¸íŠ¸ ì¸¡ ê²€ì¦ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë” ì •êµí•œ ê²€ì¦ì„ ì›í•  ê²½ìš°, zod ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•´ í¼ ë°ì´í„°ë¥¼ ì„œë²„ì—ì„œ ê²€ì¦í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```ts
"use server";

import { z } from "zod";

const schema = z.object({
  email: z.string({
    invalid_type_error: "Invalid Email",
  }),
});

export default async function createUser(formData: FormData) {
  const validatedFields = schema.safeParse({
    email: formData.get("email"),
  });

  // í¼ì´ ìœ íš¨í•˜ì§€ ì•Šìœ¼ë©´ ì—ëŸ¬ ë°˜í™˜
  if (!validatedFields.success) {
    return {
      errors: validatedFields.error.flatten().fieldErrors,
    };
  }

  // ì´í›„ ë°ì´í„° ì²˜ë¦¬ ë¡œì§...
}
```

**ğŸ” useActionState í›…ìœ¼ë¡œ ìƒíƒœ ê´€ë¦¬í•˜ê¸°**  
í¼ í•„ë“œê°€ ì„œë²„ì—ì„œ ìœ íš¨ì„± ê²€ì¦ì„ ê±°ì¹˜ê³  ë‚˜ë©´, ì•¡ì…˜ì€ ì§ë ¬í™”ëœ ê°ì²´ë¥¼ ë¦¬í„´í•  ìˆ˜ ìˆê³ , ë¦¬ì•¡íŠ¸ì˜ `useActionState` hookì„ ì‚¬ìš©í•˜ì—¬ ìœ ì €ì—ê²Œ ë©”ì‹œì§€ë¥¼ ë³´ì—¬ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- actionì„ `useActionState()`ì— ì „ë‹¬í•˜ë©´,
  Server Action í•¨ìˆ˜ëŠ” ì²« ë²ˆì§¸ ì¸ìë¡œ prevState ë˜ëŠ” ì´ˆê¸° ìƒíƒœë¥¼ ë°›ìŠµë‹ˆë‹¤.
- ì´ í›…ì€ Client Component ì•ˆì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.

```tsx
// app/actions.ts

"use server";
import { redirect } from "next/navigation";

export async function createUser(prevState: any, formData: FormData) {
  const res = await fetch("https://...");
  const json = await res.json();

  if (!res.ok) {
    return { message: "Please enter a valid email" };
  }

  redirect("/dashboard");
}
```

```tsx
// app/ui/signup.tsx

"use client";

import { useActionState } from "react";
import { createUser } from "@/app/actions";

const initialState = {
  message: "",
};

export function Signup() {
  const [state, formAction, pending] = useActionState(createUser, initialState);

  return (
    <form action={formAction}>
      <label htmlFor="email">Email</label>
      <input type="text" id="email" name="email" required />
      {/* stateë¥¼ í‘œì‹œí•  ìˆ˜ ìˆë‹¤ */}
      <p aria-live="polite">{state?.message}</p>
      <button disabled={pending}>Sign up</button>
    </form>
  );
}
```

### ë¡œë”© ìƒíƒœ ì²˜ë¦¬ (Pending States)

#### ë°©ë²• 1: useActionStateì˜ pending ê°’ ì‚¬ìš©

Server Actionì´ ì‹¤í–‰ ì¤‘ì¼ ë•Œ pending ê°’ì´ trueê°€ ë©ë‹ˆë‹¤.  
ì´ë¥¼ í†µí•´ ë²„íŠ¼ì„ ë¹„í™œì„±í™”í•˜ê±°ë‚˜ ë¡œë”© ì¸ë””ì¼€ì´í„°ë¥¼ í‘œì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### ë°©ë²• 2: useFormStatus í›… ì‚¬ìš©

ì´ í›…ì€ form ë‚´ ì œì¶œ ìƒíƒœì— ë”°ë¥¸ ë¡œë”© ì²˜ë¦¬ë¥¼ ë¶„ë¦¬ëœ ì»´í¬ë„ŒíŠ¸ë¡œ í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.

### ë‚™ê´€ì  UI ì—…ë°ì´íŠ¸ (Optimistic UI)

`useOptimistic` í›…ì„ ì‚¬ìš©í•˜ë©´ ì„œë²„ ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ê¸° ì „ì— UIë¥¼ ë¨¼ì € ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> ì˜ˆì‹œ: ë©”ì‹œì§€ë¥¼ ì„œë²„ì— ì „ì†¡í•˜ê¸° ì „ì— ì‚¬ìš©ìì—ê²Œ ë°”ë¡œ í‘œì‹œ

```tsx
"use client";

import { useOptimistic } from "react";
import { send } from "./actions";

type Message = {
  message: string;
};

export function Thread({ messages }: { messages: Message[] }) {
  // useOptimistic í›… ì‚¬ìš©
  // - ì²« ë²ˆì§¸ ì¸ìëŠ” ì´ˆê¸° ìƒíƒœ (`messages`)
  // - ë‘ ë²ˆì§¸ ì¸ìëŠ” ë‚™ê´€ì  ì—…ë°ì´íŠ¸ í•¨ìˆ˜: ê¸°ì¡´ ìƒíƒœì— ìƒˆ ë©”ì‹œì§€ë¥¼ ì¶”ê°€
  const [optimisticMessages, addOptimisticMessage] = useOptimistic<
    Message[],
    string
  >(messages, (state, newMessage) => [...state, { message: newMessage }]);

  // í¼ì´ ì œì¶œë˜ì—ˆì„ ë•Œ ì‹¤í–‰ë˜ëŠ” ì„œë²„ ì•¡ì…˜ í•¸ë“¤ëŸ¬
  const formAction = async (formData: FormData) => {
    const message = formData.get("message") as string;

    // âœ… ë‚™ê´€ì  ì—…ë°ì´íŠ¸ í•µì‹¬ ë¶€ë¶„
    // ì‚¬ìš©ìê°€ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ìë§ˆì UIì— ë°˜ì˜ (ì„œë²„ ì‘ë‹µ ì „ì— ë¨¼ì € ë³´ì—¬ì¤Œ)
    addOptimisticMessage(message);

    // ì‹¤ì œë¡œ ì„œë²„ì— ë©”ì‹œì§€ ì „ì†¡ (ë¹„ë™ê¸°)
    await send(message);
  };

  return (
    <div>
      {/* âœ… ë‚™ê´€ì ìœ¼ë¡œ UIì— í‘œì‹œë˜ëŠ” ë©”ì‹œì§€ ëª©ë¡ */}
      {/* ì‹¤ì œ ë©”ì‹œì§€ë“ , addOptimisticMessageë¡œ ì¶”ê°€í•œ ê°€ì§œ ë©”ì‹œì§€ë“  ì—¬ê¸°ì— í‘œì‹œë¨ */}
      {optimisticMessages.map((m, i) => (
        <div key={i}>{m.message}</div>
      ))}

      {/* ë©”ì‹œì§€ ì…ë ¥ í¼ */}
      <form action={formAction}>
        <input type="text" name="message" />
        <button type="submit">Send</button>
      </form>
    </div>
  );
}
```

â†’ ì„œë²„ ì‘ë‹µì´ ëŠë¦¬ë”ë¼ë„ ì‚¬ìš©ìëŠ” ë©”ì‹œì§€ê°€ ì¦‰ì‹œ í‘œì‹œë˜ëŠ” ê²ƒì²˜ëŸ¼ ëŠë‚ë‹ˆë‹¤.

### ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¡œ Server Action í˜¸ì¶œí•˜ê¸°

í¼ ì—†ì´ë„ onClick ë“±ì˜ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¥¼ í†µí•´ Server Actionì„ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
// app/like-button.tsx

"use client";

import { incrementLike } from "./actions";
import { useState } from "react";

export default function LikeButton({ initialLikes }: { initialLikes: number }) {
  const [likes, setLikes] = useState(initialLikes);

  return (
    <>
      <p>Total Likes: {likes}</p>
      <button
        onClick={async () => {
          const updatedLikes = await incrementLike();
          setLikes(updatedLikes);
        }}
      >
        Like
      </button>
    </>
  );
}
```

ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì„œë²„ì—ì„œ ì¢‹ì•„ìš” ìˆ˜ë¥¼ ì¦ê°€ì‹œí‚¤ê³ , ìµœì‹  ìˆ˜ì¹˜ë¥¼ ë°›ì•„ì„œ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.

**ğŸ“ í¼ ìš”ì†Œì˜ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œë„ ì‚¬ìš© ê°€ëŠ¥**

```tsx
// app/ui/edit-post.tsx
"use client";

import { publishPost, saveDraft } from "./actions";

export default function EditPost() {
  return (
    <form action={publishPost}>
      <textarea
        name="content"
        onChange={async (e) => {
          await saveDraft(e.target.value);
        }}
      />
      <button type="submit">Publish</button>
    </form>
  );
}
```

`onChange` ì´ë²¤íŠ¸ë¥¼ ì‚¬ìš©í•´ ì‚¬ìš©ìê°€ ì…ë ¥í•˜ëŠ” ë‚´ìš©ì„ ìë™ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> âš ï¸ ì—¬ëŸ¬ ì´ë²¤íŠ¸ê°€ **ì§§ì€ ì‹œê°„ì— ë°˜ë³µë˜ë©´ ì„œë²„ í˜¸ì¶œì´ ê³¼ë„í•˜ê²Œ ë°œìƒ**í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ,
> `debounce` ê¸°ë²•ì„ í™œìš©í•´ ë¶ˆí•„ìš”í•œ ì„œë²„ ì•¡ì…˜ í˜¸ì¶œì„ ë°©ì§€í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤.

### useEffectì—ì„œ Server Action í˜¸ì¶œ

> ë³´ì™„ í•„ìš”

ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ ìë™ìœ¼ë¡œ ì„œë²„ ì•¡ì…˜ì„ ì‹¤í–‰í•˜ê±°ë‚˜, íŠ¹ì • ìƒíƒœê°€ ë³€ê²½ë˜ì—ˆì„ ë•Œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
"use client";

import { incrementViews } from "./actions";
import { useState, useEffect } from "react";

export default function ViewCount({ initialViews }: { initialViews: number }) {
  const [views, setViews] = useState(initialViews);

  useEffect(() => {
    const updateViews = async () => {
      const updatedViews = await incrementViews();
      setViews(updatedViews);
    };

    updateViews();
  }, []);

  return <p>Total Views: {views}</p>;
}
```

### âŒ ì—ëŸ¬ ì²˜ë¦¬ (Error Handling)

- Server Action ë‚´ë¶€ì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ ê°€ì¥ ê°€ê¹Œìš´ `error.js` ë˜ëŠ” `<Suspense fallback>` ì—ì„œ ìë™ìœ¼ë¡œ ì¡í™ë‹ˆë‹¤.

- `useActionState`ë¥¼ ì‚¬ìš©í•´ ì—ëŸ¬ ê°ì²´ë¥¼ ë°˜í™˜(return) í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

### ìºì‹œ ë¦¬ë°¸ë¦¬ë°ì´ì…˜ (Revalidating Data)

ê²½ë¡œ(Path) ê¸°ë°˜ ìºì‹œ ë¬´íš¨í™”, íƒœê·¸(Tag) ê¸°ë°˜ ìºì‹œ ë¬´íš¨í™”ë¥¼ ì„œë²„ ì•¡ì…˜ ì•ˆì—ì„œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ë¦¬ë‹¤ì´ë ‰ì…˜ (Redirecting)

ì„œë²„ ì•¡ì…˜ì´ ëë‚œ í›„ íŠ¹ì • í˜ì´ì§€ë¡œ ì´ë™ì‹œí‚¤ê³  ì‹¶ì„ ë•ŒëŠ” `redirect()` ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> âš ï¸ **`redirect()`ëŠ” ë°˜ë“œì‹œ `try/catch` ë¸”ë¡ ì™¸ë¶€ì—ì„œ í˜¸ì¶œí•´ì•¼ í•©ë‹ˆë‹¤.**

```tsx
"use server";

import { redirect } from "next/navigation";
import { revalidateTag } from "next/cache";

export async function createPost(id: string) {
  // ... ë°ì´í„° ì²˜ë¦¬
  revalidateTag("posts"); // ê²Œì‹œê¸€ ëª©ë¡ ìºì‹œ ê°±ì‹ 
  redirect(`/post/${id}`); // í•´ë‹¹ ê²Œì‹œê¸€ í˜ì´ì§€ë¡œ ì´ë™
}
```

### ğŸª ì¿ í‚¤ ë‹¤ë£¨ê¸° (Cookies)

ì„œë²„ ì•¡ì…˜ ì•ˆì—ì„œ `cookies()` APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì¿ í‚¤ ì¡°íšŒ, ì„¤ì •, ì‚­ì œê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.

```tsx
"use server";

import { cookies } from "next/headers";

export async function exampleAction() {
  const cookieStore = cookies();

  // ì¿ í‚¤ ê°€ì ¸ì˜¤ê¸°
  cookieStore.get("name")?.value;

  // ì¿ í‚¤ ì„¤ì •í•˜ê¸°
  cookieStore.set("name", "Delba");

  // ì¿ í‚¤ ì‚­ì œí•˜ê¸°
  cookieStore.delete("name");
}
```

## Server Actions ë³´ì•ˆ

> ë³´ì™„ í•„ìš”

1. Server Actionì€ exportí•˜ë©´ ê³µê°œ HTTP ì—”ë“œí¬ì¸íŠ¸ê°€ ë˜ì–´ ì¸ì¦/ë³´ì•ˆ ê²€ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.

2. ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ì•¡ì…˜ì€ ìë™ ì œê±°ë˜ë©°, í´ë¡œì € ë³€ìˆ˜ëŠ” ì•”í˜¸í™”ë˜ì–´ í´ë¼ì´ì–¸íŠ¸ë¡œ ì „ë‹¬ë©ë‹ˆë‹¤.

3. POST ë©”ì„œë“œë§Œ í—ˆìš©ë˜ê³ , Originê³¼ Host í—¤ë”ê°€ ë‹¤ë¥´ë©´ ìš”ì²­ì´ ì°¨ë‹¨ë©ë‹ˆë‹¤.

4. ì—¬ëŸ¬ ì„œë²„ì—ì„œ ì¼ê´€ëœ ì•”í˜¸í™”ë¥¼ ìœ„í•´ í™˜ê²½ ë³€ìˆ˜ë¡œ í‚¤ë¥¼ ê³ ì •í•  ìˆ˜ ìˆê³ , í—ˆìš© ë„ë©”ì¸ ì„¤ì •ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.

# Incremental Static Regeneration (ISR)

ISRì€ ë‹¤ìŒê³¼ ê°™ì€ ê¸°ëŠ¥ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤:

- ì‚¬ì´íŠ¸ ì „ì²´ë¥¼ ë‹¤ì‹œ ë¹Œë“œí•˜ì§€ ì•Šê³ ë„ ì •ì  ì½˜í…ì¸ ë¥¼ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì •ì  í˜ì´ì§€ë¥¼ ë¯¸ë¦¬ ë Œë”ë§í•´ ëŒ€ë¶€ë¶„ì˜ ìš”ì²­ì„ ì²˜ë¦¬í•¨ìœ¼ë¡œì¨ ì„œë²„ ë¶€í•˜ë¥¼ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- í˜ì´ì§€ì— ì ì ˆí•œ `cache-control` í—¤ë”ë¥¼ ìë™ìœ¼ë¡œ ì¶”ê°€í•´ ì¤ë‹ˆë‹¤.
- ìˆ˜ë§ì€ ì½˜í…ì¸  í˜ì´ì§€ë¥¼ ë¹Œë“œ ì‹œê°„ ì§€ì—° ì—†ì´ íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ğŸ“„ ê°„ë‹¨í•œ ì˜ˆì œ ì„¤ëª…

```tsx
// app/blog/[id]/page.tsx

// ì´ íŒŒì¼ì€ ê° ë¸”ë¡œê·¸ ê²Œì‹œê¸€ í˜ì´ì§€(/blog/1, /blog/2 ë“±)ë¥¼ ìœ„í•œ ì½”ë“œì…ë‹ˆë‹¤.
interface Post {
  id: string;
  title: string;
  content: string;
}

// ìµœëŒ€ 60ì´ˆë§ˆë‹¤ ìºì‹œê°€ ë¬´íš¨í™”ë©ë‹ˆë‹¤.
// ì¦‰, í•œ ë²ˆ ìš”ì²­ëœ í˜ì´ì§€ëŠ” ìºì‹œë˜ì–´ ë¹ ë¥´ê²Œ ì œê³µë˜ì§€ë§Œ, 60ì´ˆê°€ ì§€ë‚˜ë©´ ìƒˆ ìš”ì²­ì´ ë“¤ì–´ì˜¬ ë•Œ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìƒˆ í˜ì´ì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
export const revalidate = 60;

// generateStaticParams()ì— ì˜í•´ ì‚¬ì „ ë Œë”ë§ ë˜ì§€ ì•Šì€ ê²½ë¡œë¡œ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ ì„œë²„ì—ì„œ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ê²Œ í•©ë‹ˆë‹¤.
export const dynamicParams = true; // falseë¡œ í•˜ë©´, ë¯¸ë¦¬ ìƒì„±ë˜ì§€ ì•Šì€ ê²½ë¡œëŠ” 404 ì—ëŸ¬ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

// ë¹Œë“œ ì‹œì ì— ë¯¸ë¦¬ ìƒì„±í•  ê²Œì‹œê¸€ ê²½ë¡œë“¤ì„ ì§€ì •í•©ë‹ˆë‹¤. (/blog/1, /blog/2 ë“±)
export async function generateStaticParams() {
  const posts: Post[] = await fetch("https://api.vercel.app/blog").then((res) =>
    res.json()
  );
  return posts.map((post) => ({
    id: String(post.id),
  }));
}

export default async function Page({
  params,
}: {
  params: Promise<{ id: string }>;
}) {
  const { id } = await params;
  const post: Post = await fetch(`https://api.vercel.app/blog/${id}`).then(
    (res) => res.json()
  ); // í•´ë‹¹ ê²Œì‹œê¸€ì˜ ìƒì„¸ ë‚´ìš© ê°€ì ¸ì˜¤ê¸°
  return (
    <main>
      <h1>{post.title}</h1>
      <p>{post.content}</p>
    </main>
  );
}
```

### ì´ ì˜ˆì œê°€ ì‘ë™í•˜ëŠ” ë°©ì‹

-`next build` í•  ë•Œ, ì•Œë ¤ì§„ ê²Œì‹œê¸€ 25ê°œ (ì˜ˆì‹œì—ì„œ 25ê°œì˜ ê¸€ë§Œ ìˆìŒ)ë§Œ ë¯¸ë¦¬ ìƒì„±ë©ë‹ˆë‹¤.

- ì´ í˜ì´ì§€ë“¤(`/blog/1`, `/blog/2` ë“±)ì€ ì¦‰ì‹œ ìºì‹œëœ ìƒíƒœë¡œ ì œê³µë©ë‹ˆë‹¤.
- ì´í›„ 60ì´ˆê°€ ì§€ë‚˜ë©´, ë‹¤ìŒ ìš”ì²­ì€ ì—¬ì „íˆ ì´ì „ ìºì‹œëœ ë‚´ìš©ì„ ë³´ì—¬ì£¼ì§€ë§Œ,
  ë™ì‹œì— ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìµœì‹  í˜ì´ì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
- ìƒˆ í˜ì´ì§€ê°€ ìƒì„±ë˜ë©´ ìºì‹œê°€ ì—…ë°ì´íŠ¸ë˜ê³ , ë‹¤ìŒë¶€í„°ëŠ” ìƒˆë¡œìš´ ì½˜í…ì¸ ê°€ ë³´ì—¬ì§ë‹ˆë‹¤.
- ë§Œì•½ `/blog/26`ì²˜ëŸ¼ ì²˜ìŒ ë³´ëŠ” ê²½ë¡œê°€ ìš”ì²­ë˜ë©´,
  Next.jsëŠ” í•´ë‹¹ í˜ì´ì§€ë¥¼ ë™ì ìœ¼ë¡œ ìƒì„± í›„ ìºì‹œí•´ì¤ë‹ˆë‹¤.

## Reference ìš”ì•½

### ğŸ”§ Route Segment Config

> **revalidate**  
> í˜ì´ì§€ ìºì‹œë¥¼ ë¬´íš¨í™”í•˜ëŠ” ì£¼ê¸°(ì´ˆ ë‹¨ìœ„)ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
>
> ```ts
> // layout.tsx | page.tsx | route.ts
> export const revalidate = 3600; // 1ì‹œê°„ë§ˆë‹¤ ìºì‹œ ë¬´íš¨í™”
> ```

> **dynamicParams**  
> í˜ì´ì§€ ìºì‹œë¥¼ ë¬´íš¨í™”í•˜ëŠ” ì£¼ê¸°(ì´ˆ ë‹¨ìœ„)ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
>
> ```ts
> // layout.tsx | page.tsx
> export const dynamicParams = true; // true | false,
> ```

## ğŸ•’ Time-based Revalidation (ì‹œê°„ ê¸°ë°˜ ì¬ê²€ì¦)

```tsx
export const revalidate = 3600; // 1ì‹œê°„ë§ˆë‹¤ ìºì‹œ ë¬´íš¨í™”

export default async function Page() {
  const data = await fetch("https://api.vercel.app/blog");
  const posts = await data.json();
  return (
    <main>
      <h1>Blog Posts</h1>
      <ul>
        {posts.map((post) => (
          <li key={post.id}>{post.title}</li>
        ))}
      </ul>
    </main>
  );
}
```

ì´ ì˜ˆì œì—ì„œëŠ” /blog í˜ì´ì§€ ìµœì´ˆ ë°©ë¬¸ ì´í›„ 1ì‹œê°„ì´ ì§€ë‚˜ê³  ë‚˜ì„œ ë°©ë¬¸í•˜ë©´ ìºì‹œëœ í˜ì´ì§€ê°€ ë³´ì—¬ì§€ê³ ,
ë‹¤ìŒ ë°©ë¬¸ë¶€í„° ìºì‹œë˜ì–´ ìˆë˜ í˜ì´ì§€ê°€ ìœ íš¨í•˜ì§€ ì•Šì•„ì§‘ë‹ˆë‹¤.
ë°±ê·¸ë¼ìš´ë“œì—ì„œ, ê°€ì¥ ìµœì‹ ì˜ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ ë°ì´í„°ë¡œ ìƒˆë¡œìš´ ë²„ì „ì˜ í˜ì´ì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

> **ğŸ’¡ TIP: ë„ˆë¬´ ì§§ì€ ì‹œê°„(ì˜ˆ: 1ì´ˆ)ë³´ë‹¤ëŠ” 1ì‹œê°„ ê°™ì€ ê¸´ ì£¼ê¸°ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.**  
> **ë” ì„¸ë°€í•œ ì—…ë°ì´íŠ¸ê°€ í•„ìš”**í•˜ë©´ **on-demand revalidation**ì„ ê³ ë ¤í•˜ì„¸ìš”.  
> **ì‹¤ì‹œê°„ì´ í•„ìš”**í•˜ë©´ **dynamic rendering**ì„ ì‚¬ìš©í•˜ëŠ” ê²Œ ì¢‹ìŠµë‹ˆë‹¤.

## On-demand Revalidation (ìš”ì²­ ì‹œ ì¬ê²€ì¦)

### âœ… ê²½ë¡œ ë‹¨ìœ„ ì¬ê²€ì¦ â€“ `revalidatePath`

```tsx
// app/actions.ts
"use server";

import { revalidatePath } from "next/cache";

export async function createPost() {
  revalidatePath("/posts"); // /posts ê²½ë¡œ ìºì‹œ ë¬´íš¨í™”
}
```

ê²Œì‹œê¸€ ì¶”ê°€ í›„ `/posts` ê²½ë¡œ í˜ì´ì§€ì˜ ìºì‹œë¥¼ ë¬´íš¨í™”í•˜ê³  ë‹¤ìŒ ìš”ì²­ ì‹œ ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ë°˜ì˜í•˜ë„ë¡ ë§Œë“­ë‹ˆë‹¤.

### âœ… íƒœê·¸ ë‹¨ìœ„ ì¬ê²€ì¦ â€“ `revalidateTag`

#### fetch ìš”ì²­ ì‹œ íƒœê·¸ ì§€ì •

```tsx
export default async function Page() {
  const data = await fetch("https://api.vercel.app/blog", {
    next: { tags: ["posts"] },
  });
  const posts = await data.json();
  // ...
}
```

#### DB ìºì‹œë¥¼ íƒœê·¸ë¡œ ê°ì‹¸ê¸° (unstable_cache ì‚¬ìš©)

```tsx
import { unstable_cache } from "next/cache";

const getCachedPosts = unstable_cache(
  async () => await db.select().from(posts),
  ["posts"],
  { revalidate: 3600, tags: ["posts"] }
);
```

#### Server Actionì—ì„œ íƒœê·¸ ë¬´íš¨í™”

```tsx
"use server";

import { revalidateTag } from "next/cache";

export async function createPost() {
  revalidateTag("posts"); // 'posts' íƒœê·¸ê°€ ë¶™ì€ ëª¨ë“  ë°ì´í„° ë¬´íš¨í™”
}
```

**ê²½ë¡œ ë‹¨ìœ„**ëŠ” **ì „ì²´ ê²½ë¡œë¥¼ ë¬´íš¨í™”**í•˜ì§€ë§Œ,
**íƒœê·¸ ë‹¨ìœ„**ëŠ” ë” ì„¸ë°€í•˜ê²Œ **íŠ¹ì • fetch ë˜ëŠ” DB ì¿¼ë¦¬ì—ë§Œ ìºì‹œ ë¬´íš¨í™”ë¥¼ ì ìš©**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## âš ï¸ ì˜ˆì™¸ ì²˜ë¦¬ (ì—ëŸ¬ ì‹œ ì²˜ë¦¬)

revalidate í•˜ë‹¤ ì˜¤ë¥˜ê°€ ë‚˜ë©´, ê°€ì¥ ìµœê·¼ì— ì„±ê³µì ìœ¼ë¡œ ìƒì„±í•œ ë°ì´í„°ë¥¼ ê³„ì†í•´ì„œ ì œê³µí•œë‹¤. ë‹¤ìŒ ìš”ì²­ë¶€í„°, next.jsëŠ” ë‹¤ì‹œ ë°ì´í„°ë¥¼ revalidateí•œë‹¤.

## ğŸ’¾ ìºì‹œ ì €ì¥ ìœ„ì¹˜ ì„¤ì •

- Vercel ë°°í¬ ì‹œ: ISR ìºì‹œëŠ” **ì§€ì† ì €ì¥ì†Œ(durable storage)** ì— ìë™ ì €ì¥ë©ë‹ˆë‹¤.
- Self-hosting (ìì²´ ì„œë²„) ì‹œ: **ìºì‹œëŠ” ì„œë²„ íŒŒì¼ ì‹œìŠ¤í…œì— ì €ì¥**ë©ë‹ˆë‹¤.

## ğŸ› ï¸ Troubleshooting (ë¬¸ì œ í•´ê²°)

### 1. ë¡œì»¬ ê°œë°œ í™˜ê²½ì—ì„œ ìºì‹œ ë””ë²„ê¹…í•˜ê¸°

`fetch()` APIë¥¼ ì‚¬ìš©í•  ë•Œ, ìš”ì²­ì´ ìºì‹œëœ ê²ƒì¸ì§€ ì•„ë‹Œì§€ë¥¼ í™•ì¸í•˜ê³  ì‹¶ë‹¤ë©´ ë¡œê¹… ì„¤ì •ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```js
// next.config.js
module.exports = {
  logging: {
    fetches: {
      fullUrl: true,
    },
  },
};
```

ìœ„ ì„¤ì •ì„ í•˜ë©´ í„°ë¯¸ë„ì— ìš”ì²­ëœ ì „ì²´ URLê³¼ ìºì‹œ ì—¬ë¶€ê°€ ì¶œë ¥ë©ë‹ˆë‹¤.

### 2. ë°°í¬ í™˜ê²½ ìºì‹œ ë™ì‘ í…ŒìŠ¤íŠ¸í•˜ê¸°

`next build` ì™€ `next start` ë¥¼ ì‹¤í–‰í•˜ì—¬ í”„ë¡œë•ì…˜ í™˜ê²½ìœ¼ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤. ìì„¸í•œ ë¡œê·¸ê°€ í•„ìš”í•˜ë©´ `.env` íŒŒì¼ì— ë‹¤ìŒì„ ì¶”ê°€í•©ë‹ˆë‹¤.

```
.env íŒŒì¼

NEXT_PRIVATE_DEBUG_CACHE=1
```

ì´ ì„¤ì •ì€ ì½˜ì†”ì— **ISR ìºì‹œ íˆíŠ¸(hit)/ë¯¸ìŠ¤(miss) ì—¬ë¶€ë¥¼ ì¶œë ¥**í•´ì¤ë‹ˆë‹¤.
ë˜í•œ ì–´ë–¤ í˜ì´ì§€ê°€ **`next build` ì‹œ ìƒì„±**ëê³ , ì–´ë–¤ í˜ì´ì§€ê°€ **ì˜¨ë””ë§¨ë“œë¡œ ìš”ì²­ë˜ë©° ìƒì„±ë˜ëŠ”ì§€ í™•ì¸**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## âš ï¸ ì£¼ì˜ì‚¬í•­ (Caveats)

**1. Node.js ëŸ°íƒ€ì„ì—ì„œë§Œ ISR ì§€ì›**

- ê¸°ë³¸ ëŸ°íƒ€ì„ì¸ Node.jsë¥¼ ì‚¬ìš©í•  ë•Œë§Œ ì‘ë™í•©ë‹ˆë‹¤.

**2. Static Export (next export)ì—ì„œëŠ” ISR ë¯¸ì§€ì›**

- ì •ì  HTMLë§Œ ë‚´ë³´ë‚´ëŠ” next exportëŠ” ISRì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

**3. ì—¬ëŸ¬ fetch ìš”ì²­ì´ ìˆëŠ” ê²½ìš°**

- ê²½ë¡œ ë‚´ì— ì—¬ëŸ¬ ê°œì˜ `fetch()` ìš”ì²­ì´ ìˆê³  ê°ê° ë‹¤ë¥¸ revalidate ì‹œê°„ì´ ì„¤ì •ë˜ì–´ ìˆë‹¤ë©´:

  - ê°€ì¥ ì§§ì€ ì‹œê°„ì´ ì „ì²´ ê²½ë¡œì˜ revalidateë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.

- í•˜ì§€ë§Œ ê° fetchì˜ revalidate ì„¤ì •ì€ ë°ì´í„° ìºì‹œ ë‹¨ì—ì„œ ì—¬ì „íˆ ì ìš©ë©ë‹ˆë‹¤.

**4. `revalidate: 0` ë˜ëŠ” `no-store`ì¸ `fetch`ê°€ ìˆìœ¼ë©´ â†’ í•´ë‹¹ ê²½ë¡œëŠ” ë™ì  ë Œë”ë§ë¨**

- ì¦‰, í•´ë‹¹ í˜ì´ì§€ëŠ” SSRì²˜ëŸ¼ ë§¤ ìš”ì²­ë§ˆë‹¤ ìƒˆë¡œ ë Œë”ë§ë©ë‹ˆë‹¤.

**5. MiddlewareëŠ” ISR ìš”ì²­ ì‹œ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ**

- ISRì„ í†µí•´ ê²½ë¡œê°€ ìƒì„±ë  ë•ŒëŠ” Middlewareê°€ ë™ì‘í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì—,
  **ë¦¬ë‹¤ì´ë ‰íŠ¸ë‚˜ URL ì¬ì‘ì„± ê°™ì€ ë¡œì§ì´ ì ìš©**ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- ë”°ë¼ì„œ ì •í™•í•œ ê²½ë¡œë¥¼ ì¬ê²€ì¦í•´ì•¼ í•¨ â†’ ì˜ˆ: `/post/1` (X: `/post-1`)
